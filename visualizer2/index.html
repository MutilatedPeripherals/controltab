<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Guitar Pro Diff Viewer</title>
  <script src="https://unpkg.com/alphatab/dist/alphaTab.min.js"></script>
</head>
<body>
  <div id="alphaTabContainer"></div>

  <script>
    // Load and compare XML files using DOMParser
    async function loadAndCompareFiles(file1Path, file2Path) {
      const xmlData1 = await fetch(file1Path).then(res => res.text());
      const xmlData2 = await fetch(file2Path).then(res => res.text());

      const parser = new DOMParser();
      const xmlDoc1 = parser.parseFromString(xmlData1, "application/xml");
      const xmlDoc2 = parser.parseFromString(xmlData2, "application/xml");

      const measures1 = xmlDoc1.getElementsByTagName("measure");
      const measures2 = xmlDoc2.getElementsByTagName("measure");

      const differingBars = [];
      for (let i = 0; i < measures1.length; i++) {
        if (measures1[i].isEqualNode(measures2[i]) === false) {
          differingBars.push(measures1[i].outerHTML); // Add differing bar from file1
        }
      }

      // Construct a new MusicXML with only differing bars
      const filteredXml = constructFilteredMusicXML(differingBars);
      renderAlphaTab(filteredXml);
    }

    // Helper function to construct a minimal MusicXML file with differing bars
    function constructFilteredMusicXML(differingBars) {
      return `<?xml version="1.0" encoding="UTF-8"?>
        <score-partwise version="3.1">
          <part-list>
            <score-part id="P1">
              <part-name>Guitar</part-name>
            </score-part>
          </part-list>
          <part id="P1">
            ${differingBars.join('')}
          </part>
        </score-partwise>`;
    }

    function renderAlphaTab(xml) {
      alphatab.render("#alphaTabContainer", {
        file: xml,
        notation: {
          // Customize settings here if needed
        }
      });
    }

    // Call the function with relative paths to load XML files
    loadAndCompareFiles('file1.xml', 'file2.xml');
  </script>
</body>
</html>
